{"version":3,"sources":["../../../../src/node_modules/async/internal/queue.js"],"names":["Object","defineProperty","exports","value","default","queue","_baseIndexOf","require","_baseIndexOf2","_interopRequireDefault","_isArray","_isArray2","_noop","_noop2","_onlyOnce","_onlyOnce2","_setImmediate","_setImmediate2","_DoublyLinkedList","_DoublyLinkedList2","_wrapAsync","_wrapAsync2","obj","__esModule","worker","concurrency","payload","Error","_worker","numRunning","workersList","processingScheduled","_insert","data","insertAtFront","callback","q","started","length","idle","drain","i","l","item","_tasks","unshift","push","process","_next","tasks","err","task","index","shift","splice","apply","arguments","error","buffer","unsaturated","isProcessing","saturated","empty","paused","kill","remove","testFn","Math","min","node","cb","running","pause","resume","module"],"mappings":"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","file":"queue.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.default = queue;\n\nvar _baseIndexOf = require('lodash/_baseIndexOf');\n\nvar _baseIndexOf2 = _interopRequireDefault(_baseIndexOf);\n\nvar _isArray = require('lodash/isArray');\n\nvar _isArray2 = _interopRequireDefault(_isArray);\n\nvar _noop = require('lodash/noop');\n\nvar _noop2 = _interopRequireDefault(_noop);\n\nvar _onlyOnce = require('./onlyOnce');\n\nvar _onlyOnce2 = _interopRequireDefault(_onlyOnce);\n\nvar _setImmediate = require('./setImmediate');\n\nvar _setImmediate2 = _interopRequireDefault(_setImmediate);\n\nvar _DoublyLinkedList = require('./DoublyLinkedList');\n\nvar _DoublyLinkedList2 = _interopRequireDefault(_DoublyLinkedList);\n\nvar _wrapAsync = require('./wrapAsync');\n\nvar _wrapAsync2 = _interopRequireDefault(_wrapAsync);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction queue(worker, concurrency, payload) {\n    if (concurrency == null) {\n        concurrency = 1;\n    } else if (concurrency === 0) {\n        throw new Error('Concurrency must not be zero');\n    }\n\n    var _worker = (0, _wrapAsync2.default)(worker);\n    var numRunning = 0;\n    var workersList = [];\n\n    var processingScheduled = false;\n    function _insert(data, insertAtFront, callback) {\n        if (callback != null && typeof callback !== 'function') {\n            throw new Error('task callback must be a function');\n        }\n        q.started = true;\n        if (!(0, _isArray2.default)(data)) {\n            data = [data];\n        }\n        if (data.length === 0 && q.idle()) {\n            // call drain immediately if there are no tasks\n            return (0, _setImmediate2.default)(function () {\n                q.drain();\n            });\n        }\n\n        for (var i = 0, l = data.length; i < l; i++) {\n            var item = {\n                data: data[i],\n                callback: callback || _noop2.default\n            };\n\n            if (insertAtFront) {\n                q._tasks.unshift(item);\n            } else {\n                q._tasks.push(item);\n            }\n        }\n\n        if (!processingScheduled) {\n            processingScheduled = true;\n            (0, _setImmediate2.default)(function () {\n                processingScheduled = false;\n                q.process();\n            });\n        }\n    }\n\n    function _next(tasks) {\n        return function (err) {\n            numRunning -= 1;\n\n            for (var i = 0, l = tasks.length; i < l; i++) {\n                var task = tasks[i];\n\n                var index = (0, _baseIndexOf2.default)(workersList, task, 0);\n                if (index === 0) {\n                    workersList.shift();\n                } else if (index > 0) {\n                    workersList.splice(index, 1);\n                }\n\n                task.callback.apply(task, arguments);\n\n                if (err != null) {\n                    q.error(err, task.data);\n                }\n            }\n\n            if (numRunning <= q.concurrency - q.buffer) {\n                q.unsaturated();\n            }\n\n            if (q.idle()) {\n                q.drain();\n            }\n            q.process();\n        };\n    }\n\n    var isProcessing = false;\n    var q = {\n        _tasks: new _DoublyLinkedList2.default(),\n        concurrency: concurrency,\n        payload: payload,\n        saturated: _noop2.default,\n        unsaturated: _noop2.default,\n        buffer: concurrency / 4,\n        empty: _noop2.default,\n        drain: _noop2.default,\n        error: _noop2.default,\n        started: false,\n        paused: false,\n        push: function (data, callback) {\n            _insert(data, false, callback);\n        },\n        kill: function () {\n            q.drain = _noop2.default;\n            q._tasks.empty();\n        },\n        unshift: function (data, callback) {\n            _insert(data, true, callback);\n        },\n        remove: function (testFn) {\n            q._tasks.remove(testFn);\n        },\n        process: function () {\n            // Avoid trying to start too many processing operations. This can occur\n            // when callbacks resolve synchronously (#1267).\n            if (isProcessing) {\n                return;\n            }\n            isProcessing = true;\n            while (!q.paused && numRunning < q.concurrency && q._tasks.length) {\n                var tasks = [],\n                    data = [];\n                var l = q._tasks.length;\n                if (q.payload) l = Math.min(l, q.payload);\n                for (var i = 0; i < l; i++) {\n                    var node = q._tasks.shift();\n                    tasks.push(node);\n                    workersList.push(node);\n                    data.push(node.data);\n                }\n\n                numRunning += 1;\n\n                if (q._tasks.length === 0) {\n                    q.empty();\n                }\n\n                if (numRunning === q.concurrency) {\n                    q.saturated();\n                }\n\n                var cb = (0, _onlyOnce2.default)(_next(tasks));\n                _worker(data, cb);\n            }\n            isProcessing = false;\n        },\n        length: function () {\n            return q._tasks.length;\n        },\n        running: function () {\n            return numRunning;\n        },\n        workersList: function () {\n            return workersList;\n        },\n        idle: function () {\n            return q._tasks.length + numRunning === 0;\n        },\n        pause: function () {\n            q.paused = true;\n        },\n        resume: function () {\n            if (q.paused === false) {\n                return;\n            }\n            q.paused = false;\n            (0, _setImmediate2.default)(q.process);\n        }\n    };\n    return q;\n}\nmodule.exports = exports['default'];"]}