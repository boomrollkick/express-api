{"version":3,"sources":["../../../src/node_modules/async/ensureAsync.js"],"names":["Object","defineProperty","exports","value","default","ensureAsync","_setImmediate","require","_setImmediate2","_interopRequireDefault","_initialParams","_initialParams2","_wrapAsync","obj","__esModule","fn","isAsync","args","callback","sync","push","innerArgs","arguments","apply","module"],"mappings":"AAAA;;AAEAA,OAAOC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AACzCC,WAAO;AADkC,CAA7C;AAGAD,QAAQE,OAAR,GAAkBC,WAAlB;;AAEA,IAAIC,gBAAgBC,QAAQ,yBAAR,CAApB;;AAEA,IAAIC,iBAAiBC,uBAAuBH,aAAvB,CAArB;;AAEA,IAAII,iBAAiBH,QAAQ,0BAAR,CAArB;;AAEA,IAAII,kBAAkBF,uBAAuBC,cAAvB,CAAtB;;AAEA,IAAIE,aAAaL,QAAQ,sBAAR,CAAjB;;AAEA,SAASE,sBAAT,CAAgCI,GAAhC,EAAqC;AAAE,WAAOA,OAAOA,IAAIC,UAAX,GAAwBD,GAAxB,GAA8B,EAAET,SAASS,GAAX,EAArC;AAAwD;;AAE/F;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA,SAASR,WAAT,CAAqBU,EAArB,EAAyB;AACrB,QAAI,CAAC,GAAGH,WAAWI,OAAf,EAAwBD,EAAxB,CAAJ,EAAiC,OAAOA,EAAP;AACjC,WAAO,CAAC,GAAGJ,gBAAgBP,OAApB,EAA6B,UAAUa,IAAV,EAAgBC,QAAhB,EAA0B;AAC1D,YAAIC,OAAO,IAAX;AACAF,aAAKG,IAAL,CAAU,YAAY;AAClB,gBAAIC,YAAYC,SAAhB;AACA,gBAAIH,IAAJ,EAAU;AACN,iBAAC,GAAGX,eAAeJ,OAAnB,EAA4B,YAAY;AACpCc,6BAASK,KAAT,CAAe,IAAf,EAAqBF,SAArB;AACH,iBAFD;AAGH,aAJD,MAIO;AACHH,yBAASK,KAAT,CAAe,IAAf,EAAqBF,SAArB;AACH;AACJ,SATD;AAUAN,WAAGQ,KAAH,CAAS,IAAT,EAAeN,IAAf;AACAE,eAAO,KAAP;AACH,KAdM,CAAP;AAeH;AACDK,OAAOtB,OAAP,GAAiBA,QAAQ,SAAR,CAAjB","file":"ensureAsync.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.default = ensureAsync;\n\nvar _setImmediate = require('./internal/setImmediate');\n\nvar _setImmediate2 = _interopRequireDefault(_setImmediate);\n\nvar _initialParams = require('./internal/initialParams');\n\nvar _initialParams2 = _interopRequireDefault(_initialParams);\n\nvar _wrapAsync = require('./internal/wrapAsync');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Wrap an async function and ensure it calls its callback on a later tick of\n * the event loop.  If the function already calls its callback on a next tick,\n * no extra deferral is added. This is useful for preventing stack overflows\n * (`RangeError: Maximum call stack size exceeded`) and generally keeping\n * [Zalgo](http://blog.izs.me/post/59142742143/designing-apis-for-asynchrony)\n * contained. ES2017 `async` functions are returned as-is -- they are immune\n * to Zalgo's corrupting influences, as they always resolve on a later tick.\n *\n * @name ensureAsync\n * @static\n * @memberOf module:Utils\n * @method\n * @category Util\n * @param {AsyncFunction} fn - an async function, one that expects a node-style\n * callback as its last argument.\n * @returns {AsyncFunction} Returns a wrapped function with the exact same call\n * signature as the function passed in.\n * @example\n *\n * function sometimesAsync(arg, callback) {\n *     if (cache[arg]) {\n *         return callback(null, cache[arg]); // this would be synchronous!!\n *     } else {\n *         doSomeIO(arg, callback); // this IO would be asynchronous\n *     }\n * }\n *\n * // this has a risk of stack overflows if many results are cached in a row\n * async.mapSeries(args, sometimesAsync, done);\n *\n * // this will defer sometimesAsync's callback if necessary,\n * // preventing stack overflows\n * async.mapSeries(args, async.ensureAsync(sometimesAsync), done);\n */\nfunction ensureAsync(fn) {\n    if ((0, _wrapAsync.isAsync)(fn)) return fn;\n    return (0, _initialParams2.default)(function (args, callback) {\n        var sync = true;\n        args.push(function () {\n            var innerArgs = arguments;\n            if (sync) {\n                (0, _setImmediate2.default)(function () {\n                    callback.apply(null, innerArgs);\n                });\n            } else {\n                callback.apply(null, innerArgs);\n            }\n        });\n        fn.apply(this, args);\n        sync = false;\n    });\n}\nmodule.exports = exports['default'];"]}