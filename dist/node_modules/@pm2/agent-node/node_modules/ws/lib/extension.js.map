{"version":3,"sources":["../../../../../../../src/node_modules/@pm2/agent-node/node_modules/ws/lib/extension.js"],"names":["tokenChars","push","dest","name","elem","Object","prototype","hasOwnProperty","call","parse","header","offers","undefined","params","mustUnescape","isEscaping","inQuotes","extensionName","paramName","start","end","i","length","code","charCodeAt","SyntaxError","slice","value","replace","token","format","extensions","keys","map","extension","configurations","Array","isArray","concat","k","values","v","join","module","exports"],"mappings":"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","file":"extension.js","sourcesContent":["'use strict';\n\n//\n// Allowed token characters:\n//\n// '!', '#', '$', '%', '&', ''', '*', '+', '-',\n// '.', 0-9, A-Z, '^', '_', '`', a-z, '|', '~'\n//\n// tokenChars[32] === 0 // ' '\n// tokenChars[33] === 1 // '!'\n// tokenChars[34] === 0 // '\"'\n// ...\n//\n// prettier-ignore\nconst tokenChars = [\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 0 - 15\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 16 - 31\n  0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, // 32 - 47\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, // 48 - 63\n  0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, // 64 - 79\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, // 80 - 95\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, // 96 - 111\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0 // 112 - 127\n];\n\n/**\n * Adds an offer to the map of extension offers or a parameter to the map of\n * parameters.\n *\n * @param {Object} dest The map of extension offers or parameters\n * @param {String} name The extension or parameter name\n * @param {(Object|Boolean|String)} elem The extension parameters or the\n *     parameter value\n * @private\n */\nfunction push(dest, name, elem) {\n  if (Object.prototype.hasOwnProperty.call(dest, name)) dest[name].push(elem);\n  else dest[name] = [elem];\n}\n\n/**\n * Parses the `Sec-WebSocket-Extensions` header into an object.\n *\n * @param {String} header The field value of the header\n * @return {Object} The parsed object\n * @public\n */\nfunction parse(header) {\n  const offers = {};\n\n  if (header === undefined || header === '') return offers;\n\n  var params = {};\n  var mustUnescape = false;\n  var isEscaping = false;\n  var inQuotes = false;\n  var extensionName;\n  var paramName;\n  var start = -1;\n  var end = -1;\n\n  for (var i = 0; i < header.length; i++) {\n    const code = header.charCodeAt(i);\n\n    if (extensionName === undefined) {\n      if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (code === 0x20 /* ' ' */ || code === 0x09 /* '\\t' */) {\n        if (end === -1 && start !== -1) end = i;\n      } else if (code === 0x3b /* ';' */ || code === 0x2c /* ',' */) {\n        if (start === -1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (end === -1) end = i;\n        const name = header.slice(start, end);\n        if (code === 0x2c) {\n          push(offers, name, params);\n          params = {};\n        } else {\n          extensionName = name;\n        }\n\n        start = end = -1;\n      } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    } else if (paramName === undefined) {\n      if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (code === 0x20 || code === 0x09) {\n        if (end === -1 && start !== -1) end = i;\n      } else if (code === 0x3b || code === 0x2c) {\n        if (start === -1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (end === -1) end = i;\n        push(params, header.slice(start, end), true);\n        if (code === 0x2c) {\n          push(offers, extensionName, params);\n          params = {};\n          extensionName = undefined;\n        }\n\n        start = end = -1;\n      } else if (code === 0x3d /* '=' */ && start !== -1 && end === -1) {\n        paramName = header.slice(start, i);\n        start = end = -1;\n      } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    } else {\n      //\n      // The value of a quoted-string after unescaping must conform to the\n      // token ABNF, so only token characters are valid.\n      // Ref: https://tools.ietf.org/html/rfc6455#section-9.1\n      //\n      if (isEscaping) {\n        if (tokenChars[code] !== 1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n        if (start === -1) start = i;\n        else if (!mustUnescape) mustUnescape = true;\n        isEscaping = false;\n      } else if (inQuotes) {\n        if (tokenChars[code] === 1) {\n          if (start === -1) start = i;\n        } else if (code === 0x22 /* '\"' */ && start !== -1) {\n          inQuotes = false;\n          end = i;\n        } else if (code === 0x5c /* '\\' */) {\n          isEscaping = true;\n        } else {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n      } else if (code === 0x22 && header.charCodeAt(i - 1) === 0x3d) {\n        inQuotes = true;\n      } else if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (start !== -1 && (code === 0x20 || code === 0x09)) {\n        if (end === -1) end = i;\n      } else if (code === 0x3b || code === 0x2c) {\n        if (start === -1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (end === -1) end = i;\n        var value = header.slice(start, end);\n        if (mustUnescape) {\n          value = value.replace(/\\\\/g, '');\n          mustUnescape = false;\n        }\n        push(params, paramName, value);\n        if (code === 0x2c) {\n          push(offers, extensionName, params);\n          params = {};\n          extensionName = undefined;\n        }\n\n        paramName = undefined;\n        start = end = -1;\n      } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    }\n  }\n\n  if (start === -1 || inQuotes) {\n    throw new SyntaxError('Unexpected end of input');\n  }\n\n  if (end === -1) end = i;\n  const token = header.slice(start, end);\n  if (extensionName === undefined) {\n    push(offers, token, {});\n  } else {\n    if (paramName === undefined) {\n      push(params, token, true);\n    } else if (mustUnescape) {\n      push(params, paramName, token.replace(/\\\\/g, ''));\n    } else {\n      push(params, paramName, token);\n    }\n    push(offers, extensionName, params);\n  }\n\n  return offers;\n}\n\n/**\n * Builds the `Sec-WebSocket-Extensions` header field value.\n *\n * @param {Object} extensions The map of extensions and parameters to format\n * @return {String} A string representing the given object\n * @public\n */\nfunction format(extensions) {\n  return Object.keys(extensions)\n    .map((extension) => {\n      var configurations = extensions[extension];\n      if (!Array.isArray(configurations)) configurations = [configurations];\n      return configurations\n        .map((params) => {\n          return [extension]\n            .concat(\n              Object.keys(params).map((k) => {\n                var values = params[k];\n                if (!Array.isArray(values)) values = [values];\n                return values\n                  .map((v) => (v === true ? k : `${k}=${v}`))\n                  .join('; ');\n              })\n            )\n            .join('; ');\n        })\n        .join(', ');\n    })\n    .join(', ');\n}\n\nmodule.exports = { format, parse };\n"]}