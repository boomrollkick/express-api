{"version":3,"sources":["../../../../../../../src/node_modules/@pm2/js-api/node_modules/ws/lib/Extensions.js"],"names":["tokenChars","push","dest","name","elem","Object","prototype","hasOwnProperty","call","parse","header","offers","undefined","params","mustUnescape","isEscaping","inQuotes","extensionName","paramName","start","end","i","length","code","charCodeAt","Error","slice","value","replace","token","format","keys","map","paramsList","Array","isArray","concat","k","p","v","join","module","exports"],"mappings":"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","file":"Extensions.js","sourcesContent":["'use strict';\n\n//\n// Allowed token characters:\n//\n// '!', '#', '$', '%', '&', ''', '*', '+', '-',\n// '.', 0-9, A-Z, '^', '_', '`', a-z, '|', '~'\n//\n// tokenChars[32] === 0 // ' '\n// tokenChars[33] === 1 // '!'\n// tokenChars[34] === 0 // '\"'\n// ...\n//\nconst tokenChars = [\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 0 - 15\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 16 - 31\n  0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, // 32 - 47\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, // 48 - 63\n  0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, // 64 - 79\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, // 80 - 95\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, // 96 - 111\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0 // 112 - 127\n];\n\n/**\n * Adds an offer to the map of extension offers or a parameter to the map of\n * parameters.\n *\n * @param {Object} dest The map of extension offers or parameters\n * @param {String} name The extension or parameter name\n * @param {(Object|Boolean|String)} elem The extension parameters or the\n *     parameter value\n * @private\n */\nfunction push (dest, name, elem) {\n  if (Object.prototype.hasOwnProperty.call(dest, name)) dest[name].push(elem);\n  else dest[name] = [elem];\n}\n\n/**\n * Parses the `Sec-WebSocket-Extensions` header into an object.\n *\n * @param {String} header The field value of the header\n * @return {Object} The parsed object\n * @public\n */\nfunction parse (header) {\n  const offers = {};\n\n  if (header === undefined || header === '') return offers;\n\n  var params = {};\n  var mustUnescape = false;\n  var isEscaping = false;\n  var inQuotes = false;\n  var extensionName;\n  var paramName;\n  var start = -1;\n  var end = -1;\n\n  for (var i = 0; i < header.length; i++) {\n    const code = header.charCodeAt(i);\n\n    if (extensionName === undefined) {\n      if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (code === 0x20/* ' ' */|| code === 0x09/* '\\t' */) {\n        if (end === -1 && start !== -1) end = i;\n      } else if (code === 0x3b/* ';' */ || code === 0x2c/* ',' */) {\n        if (start === -1) throw new Error(`unexpected character at index ${i}`);\n\n        if (end === -1) end = i;\n        const name = header.slice(start, end);\n        if (code === 0x2c) {\n          push(offers, name, params);\n          params = {};\n        } else {\n          extensionName = name;\n        }\n\n        start = end = -1;\n      } else {\n        throw new Error(`unexpected character at index ${i}`);\n      }\n    } else if (paramName === undefined) {\n      if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (code === 0x20 || code === 0x09) {\n        if (end === -1 && start !== -1) end = i;\n      } else if (code === 0x3b || code === 0x2c) {\n        if (start === -1) throw new Error(`unexpected character at index ${i}`);\n\n        if (end === -1) end = i;\n        push(params, header.slice(start, end), true);\n        if (code === 0x2c) {\n          push(offers, extensionName, params);\n          params = {};\n          extensionName = undefined;\n        }\n\n        start = end = -1;\n      } else if (code === 0x3d/* '=' */&& start !== -1 && end === -1) {\n        paramName = header.slice(start, i);\n        start = end = -1;\n      } else {\n        throw new Error(`unexpected character at index ${i}`);\n      }\n    } else {\n      //\n      // The value of a quoted-string after unescaping must conform to the\n      // token ABNF, so only token characters are valid.\n      // Ref: https://tools.ietf.org/html/rfc6455#section-9.1\n      //\n      if (isEscaping) {\n        if (tokenChars[code] !== 1) {\n          throw new Error(`unexpected character at index ${i}`);\n        }\n        if (start === -1) start = i;\n        else if (!mustUnescape) mustUnescape = true;\n        isEscaping = false;\n      } else if (inQuotes) {\n        if (tokenChars[code] === 1) {\n          if (start === -1) start = i;\n        } else if (code === 0x22/* '\"' */ && start !== -1) {\n          inQuotes = false;\n          end = i;\n        } else if (code === 0x5c/* '\\' */) {\n          isEscaping = true;\n        } else {\n          throw new Error(`unexpected character at index ${i}`);\n        }\n      } else if (code === 0x22 && header.charCodeAt(i - 1) === 0x3d) {\n        inQuotes = true;\n      } else if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (start !== -1 && (code === 0x20 || code === 0x09)) {\n        if (end === -1) end = i;\n      } else if (code === 0x3b || code === 0x2c) {\n        if (start === -1) throw new Error(`unexpected character at index ${i}`);\n\n        if (end === -1) end = i;\n        var value = header.slice(start, end);\n        if (mustUnescape) {\n          value = value.replace(/\\\\/g, '');\n          mustUnescape = false;\n        }\n        push(params, paramName, value);\n        if (code === 0x2c) {\n          push(offers, extensionName, params);\n          params = {};\n          extensionName = undefined;\n        }\n\n        paramName = undefined;\n        start = end = -1;\n      } else {\n        throw new Error(`unexpected character at index ${i}`);\n      }\n    }\n  }\n\n  if (start === -1 || inQuotes) throw new Error('unexpected end of input');\n\n  if (end === -1) end = i;\n  const token = header.slice(start, end);\n  if (extensionName === undefined) {\n    push(offers, token, {});\n  } else {\n    if (paramName === undefined) {\n      push(params, token, true);\n    } else if (mustUnescape) {\n      push(params, paramName, token.replace(/\\\\/g, ''));\n    } else {\n      push(params, paramName, token);\n    }\n    push(offers, extensionName, params);\n  }\n\n  return offers;\n}\n\n/**\n * Serializes a parsed `Sec-WebSocket-Extensions` header to a string.\n *\n * @param {Object} value The object to format\n * @return {String} A string representing the given value\n * @public\n */\nfunction format (value) {\n  return Object.keys(value).map((token) => {\n    var paramsList = value[token];\n    if (!Array.isArray(paramsList)) paramsList = [paramsList];\n    return paramsList.map((params) => {\n      return [token].concat(Object.keys(params).map((k) => {\n        var p = params[k];\n        if (!Array.isArray(p)) p = [p];\n        return p.map((v) => v === true ? k : `${k}=${v}`).join('; ');\n      })).join('; ');\n    }).join(', ');\n  }).join(', ');\n}\n\nmodule.exports = { format, parse };\n"]}