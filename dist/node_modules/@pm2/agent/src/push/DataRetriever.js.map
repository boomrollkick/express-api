{"version":3,"sources":["../../../../../../src/node_modules/@pm2/agent/src/push/DataRetriever.js"],"names":["os","require","pkg","constants","cpuMeta","number","cpus","length","info","model","module","exports","processes","conf","formattedProcs","filter","proc","pm2_env","name","match","map","axm_actions","concat","PM2_REMOTE_METHOD_ALLOWED","action_name","method","action_type","pid","interpreter","exec_interpreter","restart_time","created_at","exec_mode","watching","watch","pm_uptime","status","pm_id","unique_id","cpu","Math","floor","monit","memory","versioning","node_env","NODE_ENV","axm_monitor","axm_options","axm_dynamic","dynamic","username","process","env","SUDO_USER","C9_USER","LOGNAME","USER","LNAME","USERNAME","server","loadavg","total_mem","totalmem","free_mem","freemem","hostname","uptime","type","platform","arch","interaction","REVERSE_INTERACT","pm2_version","PM2_VERSION","pm2_agent_version","version","node_version","UNIQUE_SERVER_ID"],"mappings":"AAAA;;;;;;AAEA,IAAMA,KAAKC,QAAQ,IAAR,CAAX;AACA,IAAMC,MAAMD,QAAQ,oBAAR,CAAZ;AACA,IAAME,YAAYF,QAAQ,iBAAR,CAAlB;AACA,IAAMG,UAAU;AACdC,UAAQL,GAAGM,IAAH,GAAUC,MADJ;AAEdC,QAAMR,GAAGM,IAAH,GAAUC,MAAV,GAAmB,CAAnB,GAAuBP,GAAGM,IAAH,GAAU,CAAV,EAAaG,KAApC,GAA4C;AAFpC,CAAhB;;AAKAC,OAAOC,OAAP;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACE;;;;;AADF,2BAMiBC,SANjB,EAM4BC,IAN5B,EAMkC;AAC9BD,kBAAYA,aAAa,EAAzB;AACA,UAAME,iBAAiBF,UACpBG,MADoB,CACb;AAAA,eAAQ,CAACC,KAAKC,OAAL,CAAaC,IAAb,CAAkBC,KAAlB,CAAwB,OAAxB,CAAT;AAAA,OADa,EAEpBC,GAFoB,CAEhB,UAACJ,IAAD,EAAU;AACbA,aAAKC,OAAL,CAAaI,WAAb,GAA2BL,KAAKC,OAAL,CAAaI,WAAb,CAAyBC,MAAzB,CAAgCT,KAAKU,yBAAL,CAA+BH,GAA/B,CAAmC,kBAAU;AACtG,iBAAO,EAACI,aAAaC,MAAd,EAAsBC,aAAa,UAAnC,EAAP;AACD,SAF0D,CAAhC,CAA3B;AAGA,eAAO;AACLC,eAAKX,KAAKW,GADL;AAELT,gBAAMF,KAAKC,OAAL,CAAaC,IAFd;AAGLU,uBAAaZ,KAAKC,OAAL,CAAaY,gBAHrB;AAILC,wBAAcd,KAAKC,OAAL,CAAaa,YAJtB;AAKLC,sBAAYf,KAAKC,OAAL,CAAac,UALpB;AAMLC,qBAAWhB,KAAKC,OAAL,CAAae,SANnB;AAOLC,oBAAUjB,KAAKC,OAAL,CAAaiB,KAPlB;AAQLC,qBAAWnB,KAAKC,OAAL,CAAakB,SARnB;AASLC,kBAAQpB,KAAKC,OAAL,CAAamB,MAThB;AAULC,iBAAOrB,KAAKC,OAAL,CAAaoB,KAVf;AAWLC,qBAAWtB,KAAKC,OAAL,CAAaqB,SAXnB;;AAaLC,eAAKC,KAAKC,KAAL,CAAWzB,KAAK0B,KAAL,CAAWH,GAAtB,KAA8B,CAb9B;AAcLI,kBAAQH,KAAKC,KAAL,CAAWzB,KAAK0B,KAAL,CAAWC,MAAtB,KAAiC,CAdpC;;AAgBLC,sBAAY5B,KAAKC,OAAL,CAAa2B,UAAb,IAA2B,IAhBlC;;AAkBLC,oBAAU7B,KAAKC,OAAL,CAAa6B,QAAb,IAAyB,IAlB9B;;AAoBLzB,uBAAaL,KAAKC,OAAL,CAAaI,WAAb,IAA4B,EApBpC;AAqBL0B,uBAAa/B,KAAKC,OAAL,CAAa8B,WAAb,IAA4B,EArBpC;AAsBLC,uBAAahC,KAAKC,OAAL,CAAa+B,WAAb,IAA4B,EAtBpC;AAuBLC,uBAAajC,KAAKC,OAAL,CAAaiC,OAAb,IAAwB;AAvBhC,SAAP;AAyBD,OA/BoB,CAAvB;;AAiCA,UAAMC,WAAWC,QAAQC,GAAR,CAAYC,SAAZ,IAAyBF,QAAQC,GAAR,CAAYE,OAArC,IAAgDH,QAAQC,GAAR,CAAYG,OAA5D,IACfJ,QAAQC,GAAR,CAAYI,IADG,IACKL,QAAQC,GAAR,CAAYK,KADjB,IAC0BN,QAAQC,GAAR,CAAYM,QADvD;;AAGA,aAAO;AACLP,iBAAStC,cADJ;AAEL8C,gBAAQ;AACNC,mBAAS7D,GAAG6D,OAAH,EADH;AAENC,qBAAW9D,GAAG+D,QAAH,EAFL;AAGNC,oBAAUhE,GAAGiE,OAAH,EAHJ;AAIN1B,eAAKnC,OAJC;AAKN+C,oBAAUA,QALJ;AAMNe,oBAAUlE,GAAGkE,QAAH,EANJ;AAONC,kBAAQnE,GAAGmE,MAAH,EAPF;AAQNC,gBAAMpE,GAAGoE,IAAH,EARA;AASNC,oBAAUrE,GAAGqE,QAAH,EATJ;AAUNC,gBAAMtE,GAAGsE,IAAH,EAVA;AAWNC,uBAAa1D,KAAK2D,gBAXZ;AAYNC,uBAAa5D,KAAK6D,WAZZ;AAaNC,6BAAmBzE,IAAI0E,OAbjB;AAcNC,wBAAczB,QAAQwB,OAdhB;AAeNtC,qBAAWnC,UAAU2E;AAff;AAFH,OAAP;AAoBD;AAhEH;;AAAA;AAAA","file":"DataRetriever.js","sourcesContent":["'use strict'\n\nconst os = require('os')\nconst pkg = require('../../package.json')\nconst constants = require('../../constants')\nconst cpuMeta = {\n  number: os.cpus().length,\n  info: os.cpus().length > 0 ? os.cpus()[0].model : 'no-data'\n}\n\nmodule.exports = class DataRetriever {\n  /**\n   * Normalize each process metdata\n   * @param {Object} processes process list extracted from pm2 daemon\n   * @param {Object} conf interactor configuration\n  */\n  static status (processes, conf) {\n    processes = processes || []\n    const formattedProcs = processes\n      .filter(proc => !proc.pm2_env.name.match(/_old_/))\n      .map((proc) => {\n        proc.pm2_env.axm_actions = proc.pm2_env.axm_actions.concat(conf.PM2_REMOTE_METHOD_ALLOWED.map(method => {\n          return {action_name: method, action_type: 'internal'}\n        }))\n        return {\n          pid: proc.pid,\n          name: proc.pm2_env.name,\n          interpreter: proc.pm2_env.exec_interpreter,\n          restart_time: proc.pm2_env.restart_time,\n          created_at: proc.pm2_env.created_at,\n          exec_mode: proc.pm2_env.exec_mode,\n          watching: proc.pm2_env.watch,\n          pm_uptime: proc.pm2_env.pm_uptime,\n          status: proc.pm2_env.status,\n          pm_id: proc.pm2_env.pm_id,\n          unique_id: proc.pm2_env.unique_id,\n\n          cpu: Math.floor(proc.monit.cpu) || 0,\n          memory: Math.floor(proc.monit.memory) || 0,\n\n          versioning: proc.pm2_env.versioning || null,\n\n          node_env: proc.pm2_env.NODE_ENV || null,\n\n          axm_actions: proc.pm2_env.axm_actions || [],\n          axm_monitor: proc.pm2_env.axm_monitor || {},\n          axm_options: proc.pm2_env.axm_options || {},\n          axm_dynamic: proc.pm2_env.dynamic || {}\n        }\n      })\n\n    const username = process.env.SUDO_USER || process.env.C9_USER || process.env.LOGNAME ||\n      process.env.USER || process.env.LNAME || process.env.USERNAME\n\n    return {\n      process: formattedProcs,\n      server: {\n        loadavg: os.loadavg(),\n        total_mem: os.totalmem(),\n        free_mem: os.freemem(),\n        cpu: cpuMeta,\n        username: username,\n        hostname: os.hostname(),\n        uptime: os.uptime(),\n        type: os.type(),\n        platform: os.platform(),\n        arch: os.arch(),\n        interaction: conf.REVERSE_INTERACT,\n        pm2_version: conf.PM2_VERSION,\n        pm2_agent_version: pkg.version,\n        node_version: process.version,\n        unique_id: constants.UNIQUE_SERVER_ID\n      }\n    }\n  }\n}\n"]}