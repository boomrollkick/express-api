{"version":3,"sources":["../../../../src/node_modules/async-listener/test/fork-listen2-problem.tap.js"],"names":["fork","require","test","server","t","createServer","listen","ok","listener","__dirname","on","message","send","fail","end","close"],"mappings":"AAAA;;AAEA,IAAIA,OAAOC,QAAQ,eAAR,EAAyBD,IAApC;AACA,IAAIE,OAAOD,QAAQ,KAAR,EAAeC,IAA1B;;AAEA,IAAIC,MAAJ;;AAEAD,KAAK,iBAAL,EAAwB,UAAUE,CAAV,EAAa;AACnCD,WAASF,QAAQ,KAAR,EAAeI,YAAf,EAAT;;AAEAF,SAAOG,MAAP,CAAc,IAAd,EAAoB,YAAY;AAC9BF,MAAEG,EAAF,CAAKJ,MAAL,EAAa,+BAAb;;AAEA,QAAIK,WAAWR,KAAKS,YAAY,mBAAjB,CAAf;AACAL,MAAEG,EAAF,CAAKC,QAAL,EAAe,uBAAf;;AAEAA,aAASE,EAAT,CAAY,SAAZ,EAAuB,UAAUC,OAAV,EAAmB;AACxC,UAAIA,YAAY,UAAhB,EAA4B;AAC1BP,UAAEG,EAAF,CAAKI,OAAL,EAAc,8BAAd;AACAH,iBAASI,IAAT,CAAc,UAAd;AACD,OAHD,MAIK;AACHR,UAAES,IAAF,CAAO,mCAAmCF,OAA1C;AACD;AACDP,QAAEU,GAAF;AACD,KATD;AAUD,GAhBD;AAiBD,CApBD;;AAsBAZ,KAAK,UAAL,EAAiB,UAAUE,CAAV,EAAa;AAC5BD,SAAOY,KAAP;AACAX,IAAEU,GAAF;AACD,CAHD","file":"fork-listen2-problem.tap.js","sourcesContent":["'use strict';\n\nvar fork = require('child_process').fork;\nvar test = require('tap').test;\n\nvar server\n\ntest(\"parent listener\", function (t) {\n  server = require('net').createServer();\n\n  server.listen(8585, function () {\n    t.ok(server, \"parent listening on port 8585\");\n\n    var listener = fork(__dirname + '/fork-listener.js');\n    t.ok(listener, \"child process started\");\n\n    listener.on('message', function (message) {\n      if (message === 'shutdown') {\n        t.ok(message, \"child handled error properly\");\n        listener.send('shutdown');\n      }\n      else {\n        t.fail(\"parent got unexpected message \" + message);\n      }\n      t.end();\n    });\n  });\n});\n\ntest(\"tearDown\", function (t) {\n  server.close();\n  t.end();\n})\n"]}