{"version":3,"sources":["../../../../../src/node_modules/async-listener/test/core/core-asynclistener-error-throw-in-before-inflight.js"],"names":["process","addAsyncListener","require","assert","onAsync0","onAsync1","once","handlers0","error","stor","err","handlers1","key0","on","equal","console","log","setImmediate","removeAsyncListener"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA,IAAI,CAACA,QAAQC,gBAAb,EAA+BC,QAAQ,gBAAR;;AAE/B,IAAIC,SAASD,QAAQ,QAAR,CAAb;;AAEA,SAASE,QAAT,GAAoB,CAAE;AACtB,SAASC,QAAT,GAAoB,CAAE;;AAEtB,IAAIC,OAAO,CAAX;AACA,IAAIC,YAAY;AACdC,SAAO,eAAUC,IAAV,EAAgBC,GAAhB,EAAqB;AAC1B;AACAJ;AACD;AAJa,CAAhB;;AAOA,IAAIK,YAAY;AACdH,SAAO,eAAUC,IAAV,EAAgBC,GAAhB,EAAqB;AAC1B;AACA;AACA,UAAM,wBAAN;AACD;AALa,CAAhB;;AAQA,IAAIE,OAAOZ,QAAQC,gBAAR,CAAyBG,QAAzB,EAAmCG,SAAnC,CAAX;;AAEAP,QAAQa,EAAR,CAAW,mBAAX,EAAgC,UAAUH,GAAV,EAAe;AAC7C;AACAP,SAAOW,KAAP,CAAaR,IAAb,EAAmB,CAAnB;AACAS,UAAQC,GAAR,CAAY,IAAZ;AACD,CAJD;;AAMAC,aAAa,YAAY;AACvB,QAAM,CAAN;AACD,CAFD;;AAIAjB,QAAQC,gBAAR,CAAyBI,QAAzB,EAAmCM,SAAnC;AACAX,QAAQkB,mBAAR,CAA4BN,IAA5B","file":"core-asynclistener-error-throw-in-before-inflight.js","sourcesContent":["// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n\nif (!process.addAsyncListener) require('../../index.js');\n\nvar assert = require('assert');\n\nfunction onAsync0() {}\nfunction onAsync1() {}\n\nvar once = 0;\nvar handlers0 = {\n  error: function (stor, err) {\n    // should catch the error *once*\n    once++;\n  }\n}\n\nvar handlers1 = {\n  error: function (stor, err) {\n    // this error handler is bound *after* the async callback\n    // and it should not handle the error\n    throw \"Should Never Be Called\";\n  }\n}\n\nvar key0 = process.addAsyncListener(onAsync0, handlers0);\n\nprocess.on('uncaughtException', function (err) {\n  // handlers0 error handler must be called once only\n  assert.equal(once, 1);\n  console.log('ok');\n});\n\nsetImmediate(function () {\n  throw 1;\n});\n\nprocess.addAsyncListener(onAsync1, handlers1);\nprocess.removeAsyncListener(key0);\n"]}