{"version":3,"sources":["../../../../src/node_modules/async-listener/test/core-asynclistener-error.simple.js"],"names":["PORT","process","addAsyncListener","require","global","setImmediate","setTimeout","assert","dns","fs","net","addListener","removeListener","removeAsyncListener","caught","expectCaught","asyncL","callbacksObj","error","domain","er","message","on","console","log","equal","listener","createAsyncListener","nextTick","Error","b","setInterval","clearInterval","stat","exists","realpath","server","createServer","close","listen","client","connect","end","lookup"],"mappings":"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","file":"core-asynclistener-error.simple.js","sourcesContent":["// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar PORT = 12346;\n\nif (!process.addAsyncListener) require('../index.js');\nif (!global.setImmediate) global.setImmediate = setTimeout;\n\nvar assert = require('assert');\nvar dns = require('dns');\nvar fs = require('fs');\nvar net = require('net');\nvar addListener = process.addAsyncListener;\nvar removeListener = process.removeAsyncListener;\n\nvar caught = 0;\nvar expectCaught = 0;\n\nfunction asyncL() { }\n\nvar callbacksObj = {\n  error: function(domain, er) {\n    caught++;\n\n    switch (er.message) {\n      case 'sync throw':\n      case 'setTimeout - simple':\n      case 'setImmediate - simple':\n      case 'setInterval - simple':\n      case 'process.nextTick - simple':\n      case 'setTimeout - nested':\n      case 'process.nextTick - nested':\n      case 'setImmediate - nested':\n      case 'setTimeout2 - nested':\n      case 'setInterval - nested':\n      case 'fs - file does not exist':\n      case 'fs - nested file does not exist':\n      case 'fs - exists':\n      case 'fs - realpath':\n      case 'net - connection listener':\n      case 'net - server listening':\n      case 'net - client connect':\n      case 'dns - lookup':\n        return true;\n\n      default:\n        return false;\n    }\n  }\n};\n\nprocess.on('exit', function() {\n  console.log('caught:', caught);\n  console.log('expected:', expectCaught);\n  assert.equal(caught, expectCaught, 'caught all expected errors');\n  console.log('ok');\n});\n\nvar listener = process.createAsyncListener(asyncL, callbacksObj);\n\n\n// Catch synchronous throws\nprocess.nextTick(function() {\n  addListener(listener);\n\n  expectCaught++;\n  throw new Error('sync throw');\n\n  removeListener(listener);\n});\n\n\n// Simple cases\nprocess.nextTick(function() {\n  addListener(listener);\n\n  setTimeout(function() {\n    throw new Error('setTimeout - simple');\n  });\n  expectCaught++;\n\n  setImmediate(function() {\n    throw new Error('setImmediate - simple');\n  });\n  expectCaught++;\n\n  var b = setInterval(function() {\n    clearInterval(b);\n    throw new Error('setInterval - simple');\n  });\n  expectCaught++;\n\n  process.nextTick(function() {\n    throw new Error('process.nextTick - simple');\n  });\n  expectCaught++;\n\n  removeListener(listener);\n});\n\n\n// Deeply nested\nprocess.nextTick(function() {\n  addListener(listener);\n\n  setTimeout(function() {\n    process.nextTick(function() {\n      setImmediate(function() {\n        var b = setInterval(function() {\n          clearInterval(b);\n          throw new Error('setInterval - nested');\n        });\n        expectCaught++;\n        throw new Error('setImmediate - nested');\n      });\n      expectCaught++;\n      throw new Error('process.nextTick - nested');\n    });\n    expectCaught++;\n    setTimeout(function() {\n      throw new Error('setTimeout2 - nested');\n    });\n    expectCaught++;\n    throw new Error('setTimeout - nested');\n  });\n  expectCaught++;\n\n  removeListener(listener);\n});\n\n\n// FS\nprocess.nextTick(function() {\n  addListener(listener);\n\n  fs.stat('does not exist', function() {\n    throw new Error('fs - file does not exist');\n  });\n  expectCaught++;\n\n  fs.exists('hi all', function() {\n    throw new Error('fs - exists');\n  });\n  expectCaught++;\n\n  fs.realpath('/some/path', function() {\n    throw new Error('fs - realpath');\n  });\n  expectCaught++;\n\n  removeListener(listener);\n});\n\n\n// Nested FS\nprocess.nextTick(function() {\n  addListener(listener);\n\n  setTimeout(function() {\n    setImmediate(function() {\n      var b = setInterval(function() {\n        clearInterval(b);\n        process.nextTick(function() {\n          fs.stat('does not exist', function() {\n            throw new Error('fs - nested file does not exist');\n          });\n          expectCaught++;\n        });\n      });\n    });\n  });\n\n  removeListener(listener);\n});\n\n\n// Net\nprocess.nextTick(function() {\n  addListener(listener);\n\n  var server = net.createServer(function() {\n    server.close();\n    throw new Error('net - connection listener');\n  });\n  expectCaught++;\n\n  server.listen(PORT, function() {\n    var client = net.connect(PORT, function() {\n      client.end();\n      throw new Error('net - client connect');\n    });\n    expectCaught++;\n    throw new Error('net - server listening');\n  });\n  expectCaught++;\n\n  removeListener(listener);\n});\n\n\n// DNS\nprocess.nextTick(function() {\n  addListener(listener);\n\n  dns.lookup('localhost', function() {\n    throw new Error('dns - lookup');\n  });\n  expectCaught++;\n\n  removeListener(listener);\n});\n"]}