{"version":3,"sources":["../../../src/node_modules/async-listener/index.js"],"names":["process","addAsyncListener","Error","shimmer","require","semver","wrap","massWrap","wrapCallback","util","v6plus","gte","version","v7plus","v8plus","v11plus","net","_normalizeArgs","args","length","arg0","options","isPipeName","path","port","host","cb","_normalizeConnectArgs","toNumber","x","Number","Server","prototype","wrapSetUpListenHandle","original","on","socket","_handle","onread","apply","arguments","onconnection","patchOnRead","ctx","handle","_originalOnread","Socket","Array","isArray","Object","getOwnPropertySymbols","result","http","Agent","req","onSocket","childProcess","wrapChildProcess","child","stdio","forEach","activatorFirst","onexit","ChildProcess","_fatalException","_originalNextTick","nextTick","processors","_nextDomainTick","push","_tickDomainCallback","activator","asynchronizers","global","setImmediate","timers","patchGlobalTimers","setTimeout","dns","resolveNaptr","fs","lchown","lchmod","ftruncate","zlib","err","Deflate","proto","getPrototypeOf","_transform","write","flush","end","crypto","toWrap","instrumentPromise","Promise","toString","promiseListener","create","resolve","then","notSync","removeAsyncListener","wrapPromise","wrappedPromise","executor","context","promise","wrappedExecutor","__proto__","reject","wrappedResolve","wrappedReject","val","ensureAslWrapper","inherits","wrapThen","chain","PromiseFunctions","key","overwrite","__asl_wrapper","propagateAslWrapper","fn","next","nextResult","call","returnVal","error","errorVal","proxyWrapper","aslWrapper","wrappedThen","map","bind","last","fallback","cbIdx","i","a","b","c","d","e","s"],"mappings":"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","file":"index.js","sourcesContent":["'use strict';\n\nif (process.addAsyncListener) throw new Error(\"Don't require polyfill unless needed\");\n\nvar shimmer      = require('shimmer')\n  , semver       = require('semver')\n  , wrap         = shimmer.wrap\n  , massWrap     = shimmer.massWrap\n  , wrapCallback = require('./glue.js')\n  , util         = require('util')\n  ;\n\nvar v6plus = semver.gte(process.version, '6.0.0');\nvar v7plus = semver.gte(process.version, '7.0.0');\nvar v8plus = semver.gte(process.version, '8.0.0');\nvar v11plus = semver.gte(process.version, '11.0.0');\n\nvar net = require('net');\n\n// From Node.js v7.0.0, net._normalizeConnectArgs have been renamed net._normalizeArgs\nif (v7plus && !net._normalizeArgs) {\n  // a polyfill in our polyfill etc so forth -- taken from node master on 2017/03/09\n  net._normalizeArgs = function (args) {\n    if (args.length === 0) {\n      return [{}, null];\n    }\n\n    var arg0 = args[0];\n    var options = {};\n    if (typeof arg0 === 'object' && arg0 !== null) {\n      // (options[...][, cb])\n      options = arg0;\n    } else if (isPipeName(arg0)) {\n      // (path[...][, cb])\n      options.path = arg0;\n    } else {\n      // ([port][, host][...][, cb])\n      options.port = arg0;\n      if (args.length > 1 && typeof args[1] === 'string') {\n        options.host = args[1];\n      }\n    }\n\n    var cb = args[args.length - 1];\n    if (typeof cb !== 'function')\n      return [options, null];\n    else\n      return [options, cb];\n  }\n} else if (!v7plus && !net._normalizeConnectArgs) {\n  // a polyfill in our polyfill etc so forth -- taken from node master on 2013/10/30\n  net._normalizeConnectArgs = function (args) {\n    var options = {};\n\n    function toNumber(x) { return (x = Number(x)) >= 0 ? x : false; }\n\n    if (typeof args[0] === 'object' && args[0] !== null) {\n      // connect(options, [cb])\n      options = args[0];\n    }\n    else if (typeof args[0] === 'string' && toNumber(args[0]) === false) {\n      // connect(path, [cb]);\n      options.path = args[0];\n    }\n    else {\n      // connect(port, [host], [cb])\n      options.port = args[0];\n      if (typeof args[1] === 'string') {\n        options.host = args[1];\n      }\n    }\n\n    var cb = args[args.length - 1];\n    return typeof cb === 'function' ? [options, cb] : [options];\n  };\n}\n\n// In https://github.com/nodejs/node/pull/11796 `_listen2` was renamed\n// `_setUpListenHandle`. It's still aliased as `_listen2`, and currently the\n// Node internals still call the alias - but who knows for how long. So better\n// make sure we use the new name instead if available.\nif ('_setUpListenHandle' in net.Server.prototype) {\n  wrap(net.Server.prototype, '_setUpListenHandle', wrapSetUpListenHandle);\n} else {\n  wrap(net.Server.prototype, '_listen2', wrapSetUpListenHandle);\n}\n\nfunction wrapSetUpListenHandle(original) {\n  return function () {\n    this.on('connection', function (socket) {\n      if (socket._handle) {\n        socket._handle.onread = wrapCallback(socket._handle.onread);\n      }\n    });\n\n    try {\n      return original.apply(this, arguments);\n    }\n    finally {\n      // the handle will only not be set in cases where there has been an error\n      if (this._handle && this._handle.onconnection) {\n        this._handle.onconnection = wrapCallback(this._handle.onconnection);\n      }\n    }\n  };\n}\n\nfunction patchOnRead(ctx) {\n  if (ctx && ctx._handle) {\n    var handle = ctx._handle;\n    if (!handle._originalOnread) {\n      handle._originalOnread = handle.onread;\n    }\n    handle.onread = wrapCallback(handle._originalOnread);\n  }\n}\n\nwrap(net.Socket.prototype, 'connect', function (original) {\n  return function () {\n    var args;\n    // Node core uses an internal Symbol here to guard against the edge-case\n    // where the user accidentally passes in an array. As we don't have access\n    // to this Symbol we resort to this hack where we just detect if there is a\n    // symbol or not. Checking for the number of Symbols is by no means a fool\n    // proof solution, but it catches the most basic cases.\n    if (v8plus &&\n        Array.isArray(arguments[0]) &&\n        Object.getOwnPropertySymbols(arguments[0]).length > 0) {\n      // already normalized\n      args = arguments[0];\n    } else {\n      // From Node.js v7.0.0, net._normalizeConnectArgs have been renamed net._normalizeArgs\n      args = v7plus\n        ? net._normalizeArgs(arguments)\n        : net._normalizeConnectArgs(arguments);\n    }\n    if (args[1]) args[1] = wrapCallback(args[1]);\n    var result = original.apply(this, args);\n    patchOnRead(this);\n    return result;\n  };\n});\n\nvar http = require('http');\n\n// NOTE: A rewrite occurred in 0.11 that changed the addRequest signature\n// from (req, host, port, localAddress) to (req, options)\n// Here, I use the longer signature to maintain 0.10 support, even though\n// the rest of the arguments aren't actually used\nwrap(http.Agent.prototype, 'addRequest', function (original) {\n  return function (req) {\n    var onSocket = req.onSocket;\n    req.onSocket = wrapCallback(function (socket) {\n      patchOnRead(socket);\n      return onSocket.apply(this, arguments);\n    });\n    return original.apply(this, arguments);\n  };\n});\n\nvar childProcess = require('child_process');\n\nfunction wrapChildProcess(child) {\n  if (Array.isArray(child.stdio)) {\n    child.stdio.forEach(function (socket) {\n      if (socket && socket._handle) {\n        socket._handle.onread = wrapCallback(socket._handle.onread);\n        wrap(socket._handle, 'close', activatorFirst);\n      }\n    });\n  }\n\n  if (child._handle) {\n    child._handle.onexit = wrapCallback(child._handle.onexit);\n  }\n}\n\n// iojs v2.0.0+\nif (childProcess.ChildProcess) {\n  wrap(childProcess.ChildProcess.prototype, 'spawn', function (original) {\n    return function () {\n      var result = original.apply(this, arguments);\n      wrapChildProcess(this);\n      return result;\n    };\n  });\n} else {\n  massWrap(childProcess, [\n    'execFile', // exec is implemented in terms of execFile\n    'fork',\n    'spawn'\n  ], function (original) {\n    return function () {\n      var result = original.apply(this, arguments);\n      wrapChildProcess(result);\n      return result;\n    };\n  });\n}\n\n// need unwrapped nextTick for use within < 0.9 async error handling\nif (!process._fatalException) {\n  process._originalNextTick = process.nextTick;\n}\n\nvar processors = [];\nif (process._nextDomainTick) processors.push('_nextDomainTick');\nif (process._tickDomainCallback) processors.push('_tickDomainCallback');\n\nmassWrap(\n  process,\n  processors,\n  activator\n);\nwrap(process, 'nextTick', activatorFirst);\n\nvar asynchronizers = [\n  'setTimeout',\n  'setInterval'\n];\nif (global.setImmediate) asynchronizers.push('setImmediate');\n\nvar timers = require('timers');\nvar patchGlobalTimers = global.setTimeout === timers.setTimeout;\n\nmassWrap(\n  timers,\n  asynchronizers,\n  activatorFirst\n);\n\nif (patchGlobalTimers) {\n  massWrap(\n    global,\n    asynchronizers,\n    activatorFirst\n  );\n}\n\nvar dns = require('dns');\nmassWrap(\n  dns,\n  [\n    'lookup',\n    'resolve',\n    'resolve4',\n    'resolve6',\n    'resolveCname',\n    'resolveMx',\n    'resolveNs',\n    'resolveTxt',\n    'resolveSrv',\n    'reverse'\n  ],\n  activator\n);\n\nif (dns.resolveNaptr) wrap(dns, 'resolveNaptr', activator);\n\nvar fs = require('fs');\nmassWrap(\n  fs,\n  [\n    'watch',\n    'rename',\n    'truncate',\n    'chown',\n    'fchown',\n    'chmod',\n    'fchmod',\n    'stat',\n    'lstat',\n    'fstat',\n    'link',\n    'symlink',\n    'readlink',\n    'realpath',\n    'unlink',\n    'rmdir',\n    'mkdir',\n    'readdir',\n    'close',\n    'open',\n    'utimes',\n    'futimes',\n    'fsync',\n    'write',\n    'read',\n    'readFile',\n    'writeFile',\n    'appendFile',\n    'watchFile',\n    'unwatchFile',\n    \"exists\",\n  ],\n  activator\n);\n\n// only wrap lchown and lchmod on systems that have them.\nif (fs.lchown) wrap(fs, 'lchown', activator);\nif (fs.lchmod) wrap(fs, 'lchmod', activator);\n\n// only wrap ftruncate in versions of node that have it\nif (fs.ftruncate) wrap(fs, 'ftruncate', activator);\n\n// Wrap zlib streams\nvar zlib;\ntry { zlib = require('zlib'); } catch (err) { }\nif (zlib && zlib.Deflate && zlib.Deflate.prototype) {\n  var proto = Object.getPrototypeOf(zlib.Deflate.prototype);\n  if (proto._transform) {\n    // streams2\n    wrap(proto, \"_transform\", activator);\n  }\n  else if (proto.write && proto.flush && proto.end) {\n    // plain ol' streams\n    massWrap(\n      proto,\n      [\n        'write',\n        'flush',\n        'end'\n      ],\n      activator\n    );\n  }\n}\n\n// Wrap Crypto\nvar crypto;\ntry { crypto = require('crypto'); } catch (err) { }\nif (crypto) {\n\n  var toWrap = [\n      'pbkdf2',\n      'randomBytes',\n  ];\n  if (!v11plus) {\n    toWrap.push('pseudoRandomBytes');\n  }\n\n  massWrap(crypto, toWrap, activator);\n}\n\n// It is unlikely that any userspace promise implementations have a native\n// implementation of both Promise and Promise.toString.\nvar instrumentPromise = !!global.Promise &&\n    Promise.toString() === 'function Promise() { [native code] }' &&\n    Promise.toString.toString() === 'function toString() { [native code] }';\n\n// Check that global Promise is native\nif (instrumentPromise) {\n  // shoult not use any methods that have already been wrapped\n  var promiseListener = process.addAsyncListener({\n    create: function create() {\n      instrumentPromise = false;\n    }\n  });\n\n  // should not resolve synchronously\n  global.Promise.resolve(true).then(function notSync() {\n    instrumentPromise = false;\n  });\n\n  process.removeAsyncListener(promiseListener);\n}\n\n/*\n * Native promises use the microtask queue to make all callbacks run\n * asynchronously to avoid Zalgo issues. Since the microtask queue is not\n * exposed externally, promises need to be modified in a fairly invasive and\n * complex way.\n *\n * The async boundary in promises that must be patched is between the\n * fulfillment of the promise and the execution of any callback that is waiting\n * for that fulfillment to happen. This means that we need to trigger a create\n * when resolve or reject is called and trigger before, after and error handlers\n * around the callback execution. There may be multiple callbacks for each\n * fulfilled promise, so handlers will behave similar to setInterval where\n * there may be multiple before after and error calls for each create call.\n *\n * async-listener monkeypatching has one basic entry point: `wrapCallback`.\n * `wrapCallback` should be called when create should be triggered and be\n * passed a function to wrap, which will execute the body of the async work.\n * The resolve and reject calls can be modified fairly easily to call\n * `wrapCallback`, but at the time of resolve and reject all the work to be done\n * on fulfillment may not be defined, since a call to then, chain or fetch can\n * be made even after the promise has been fulfilled. To get around this, we\n * create a placeholder function which will call a function passed into it,\n * since the call to the main work is being made from within the wrapped\n * function, async-listener will work correctly.\n *\n * There is another complication with monkeypatching Promises. Calls to then,\n * chain and catch each create new Promises that are fulfilled internally in\n * different ways depending on the return value of the callback. When the\n * callback return a Promise, the new Promise is resolved asynchronously after\n * the returned Promise has been also been resolved. When something other than\n * a promise is resolved the resolve call for the new Promise is put in the\n * microtask queue and asynchronously resolved.\n *\n * Then must be wrapped so that its returned promise has a wrapper that can be\n * used to invoke further continuations. This wrapper cannot be created until\n * after the callback has run, since the callback may return either a promise\n * or another value. Fortunately we already have a wrapper function around the\n * callback we can use (the wrapper created by resolve or reject).\n *\n * By adding an additional argument to this wrapper, we can pass in the\n * returned promise so it can have its own wrapper appended. the wrapper\n * function can the call the callback, and take action based on the return\n * value. If a promise is returned, the new Promise can proxy the returned\n * Promise's wrapper (this wrapper may not exist yet, but will by the time the\n * wrapper needs to be invoked). Otherwise, a new wrapper can be create the\n * same way as in resolve and reject. Since this wrapper is created\n * synchronously within another wrapper, it will properly appear as a\n * continuation from within the callback.\n */\n\nif (instrumentPromise) {\n  wrapPromise();\n}\n\nfunction wrapPromise() {\n  var Promise = global.Promise;\n\n  // Updates to this class should also be applied to the the ES6 version\n  // in es6-wrapped-promise.js.\n  function wrappedPromise(executor) {\n    if (!(this instanceof wrappedPromise)) {\n      return Promise(executor);\n    }\n\n    if (typeof executor !== 'function') {\n      return new Promise(executor);\n    }\n\n    var context, args;\n    var promise = new Promise(wrappedExecutor);\n    promise.__proto__ = wrappedPromise.prototype;\n\n    try {\n      executor.apply(context, args);\n    } catch (err) {\n      args[1](err);\n    }\n\n    return promise;\n\n    function wrappedExecutor(resolve, reject) {\n      context = this;\n      args = [wrappedResolve, wrappedReject];\n\n      // These wrappers create a function that can be passed a function and an argument to\n      // call as a continuation from the resolve or reject.\n      function wrappedResolve(val) {\n        ensureAslWrapper(promise, false);\n        return resolve(val);\n      }\n\n      function wrappedReject(val) {\n        ensureAslWrapper(promise, false);\n        return reject(val);\n      }\n    }\n  }\n\n  util.inherits(wrappedPromise, Promise);\n\n  wrap(Promise.prototype, 'then', wrapThen);\n  // Node.js <v7 only, alias for .then\n  if (Promise.prototype.chain) {\n    wrap(Promise.prototype, 'chain', wrapThen);\n  }\n\n  if (v6plus) {\n    global.Promise = require('./es6-wrapped-promise.js')(Promise, ensureAslWrapper);\n  } else {\n    var PromiseFunctions = [\n      'all',\n      'race',\n      'reject',\n      'resolve',\n      'accept',  // Node.js <v7 only\n      'defer'    // Node.js <v7 only\n    ];\n\n    PromiseFunctions.forEach(function(key) {\n      // don't break `in` by creating a key for undefined entries\n      if (typeof Promise[key] === 'function') {\n        wrappedPromise[key] = Promise[key];\n      }\n    });\n    global.Promise = wrappedPromise\n  }\n\n  function ensureAslWrapper(promise, overwrite) {\n    if (!promise.__asl_wrapper || overwrite) {\n      promise.__asl_wrapper = wrapCallback(propagateAslWrapper);\n    }\n  }\n\n  function propagateAslWrapper(ctx, fn, result, next) {\n    var nextResult;\n    try {\n      nextResult = fn.call(ctx, result);\n      return {returnVal: nextResult, error: false}\n    } catch (err) {\n      return {errorVal: err, error: true}\n    } finally {\n      // Wrap any resulting futures as continuations.\n      if (nextResult instanceof Promise) {\n        next.__asl_wrapper = function proxyWrapper() {\n          var aslWrapper = nextResult.__asl_wrapper || propagateAslWrapper;\n          return aslWrapper.apply(this, arguments);\n        }\n      } else {\n        ensureAslWrapper(next, true);\n      }\n    }\n  }\n\n  function wrapThen(original) {\n    return function wrappedThen() {\n      var promise = this;\n      var next = original.apply(promise, Array.prototype.map.call(arguments, bind));\n\n      next.__asl_wrapper = function proxyWrapper(ctx, fn, val, last) {\n        if (promise.__asl_wrapper) {\n          promise.__asl_wrapper(ctx, function () {}, null, next);\n          return next.__asl_wrapper(ctx, fn, val, last);\n        }\n        return propagateAslWrapper(ctx, fn, val, last);\n      }\n\n      return next;\n\n      // wrap callbacks (success, error) so that the callbacks will be called as a\n      // continuations of the resolve or reject call using the __asl_wrapper created above.\n      function bind(fn) {\n        if (typeof fn !== 'function') return fn;\n        return wrapCallback(function (val) {\n          var result = (promise.__asl_wrapper || propagateAslWrapper)(this, fn, val, next);\n          if (result.error) {\n            throw result.errorVal\n          } else {\n            return result.returnVal\n          }\n        });\n      }\n    }\n  }\n}\n\n// Shim activator for functions that have callback last\nfunction activator(fn) {\n  var fallback = function () {\n    var args;\n    var cbIdx = arguments.length - 1;\n    if (typeof arguments[cbIdx] === \"function\") {\n      args = Array(arguments.length)\n      for (var i = 0; i < arguments.length - 1; i++) {\n        args[i] = arguments[i];\n      }\n      args[cbIdx] = wrapCallback(arguments[cbIdx]);\n    }\n    return fn.apply(this, args || arguments);\n  };\n  // Preserve function length for small arg count functions.\n  switch (fn.length) {\n    case 1:\n      return function (cb) {\n        if (arguments.length !== 1) return fallback.apply(this, arguments);\n        if (typeof cb === \"function\") cb = wrapCallback(cb);\n        return fn.call(this, cb);\n      };\n    case 2:\n      return function (a, cb) {\n        if (arguments.length !== 2) return fallback.apply(this, arguments);\n        if (typeof cb === \"function\") cb = wrapCallback(cb);\n        return fn.call(this, a, cb);\n      };\n    case 3:\n      return function (a, b, cb) {\n        if (arguments.length !== 3) return fallback.apply(this, arguments);\n        if (typeof cb === \"function\") cb = wrapCallback(cb);\n        return fn.call(this, a, b, cb);\n      };\n    case 4:\n      return function (a, b, c, cb) {\n        if (arguments.length !== 4) return fallback.apply(this, arguments);\n        if (typeof cb === \"function\") cb = wrapCallback(cb);\n        return fn.call(this, a, b, c, cb);\n      };\n    case 5:\n      return function (a, b, c, d, cb) {\n        if (arguments.length !== 5) return fallback.apply(this, arguments);\n        if (typeof cb === \"function\") cb = wrapCallback(cb);\n        return fn.call(this, a, b, c, d, cb);\n      };\n    case 6:\n      return function (a, b, c, d, e, cb) {\n        if (arguments.length !== 6) return fallback.apply(this, arguments);\n        if (typeof cb === \"function\") cb = wrapCallback(cb);\n        return fn.call(this, a, b, c, d, e, cb);\n      };\n    default:\n      return fallback;\n  }\n}\n\n// Shim activator for functions that have callback first\nfunction activatorFirst(fn) {\n  var fallback = function () {\n    var args;\n    if (typeof arguments[0] === \"function\") {\n      args = Array(arguments.length)\n      args[0] = wrapCallback(arguments[0]);\n      for (var i = 1; i < arguments.length; i++) {\n        args[i] = arguments[i];\n      }\n    }\n    return fn.apply(this, args || arguments);\n  };\n  // Preserve function length for small arg count functions.\n  switch (fn.length) {\n    case 1:\n      return function (cb) {\n        if (arguments.length !== 1) return fallback.apply(this, arguments);\n        if (typeof cb === \"function\") cb = wrapCallback(cb);\n        return fn.call(this, cb);\n      };\n    case 2:\n      return function (cb, a) {\n        if (arguments.length !== 2) return fallback.apply(this, arguments);\n        if (typeof cb === \"function\") cb = wrapCallback(cb);\n        return fn.call(this, cb, a);\n      };\n    case 3:\n      return function (cb, a, b) {\n        if (arguments.length !== 3) return fallback.apply(this, arguments);\n        if (typeof cb === \"function\") cb = wrapCallback(cb);\n        return fn.call(this, cb, a, b);\n      };\n    case 4:\n      return function (cb, a, b, c) {\n        if (arguments.length !== 4) return fallback.apply(this, arguments);\n        if (typeof cb === \"function\") cb = wrapCallback(cb);\n        return fn.call(this, cb, a, b, c);\n      };\n    case 5:\n      return function (cb, a, b, c, d) {\n        if (arguments.length !== 5) return fallback.apply(this, arguments);\n        if (typeof cb === \"function\") cb = wrapCallback(cb);\n        return fn.call(this, cb, a, b, c, d);\n      };\n    case 6:\n      return function (cb, a, b, c, d, e) {\n        if (arguments.length !== 6) return fallback.apply(this, arguments);\n        if (typeof cb === \"function\") cb = wrapCallback(cb);\n        return fn.call(this, cb, a, b, c, d, e);\n      };\n    default:\n      return fallback;\n  }\n}\n\n// taken from node master on 2017/03/09\nfunction toNumber(x) {\n  return (x = Number(x)) >= 0 ? x : false;\n}\n\n// taken from node master on 2017/03/09\nfunction isPipeName(s) {\n  return typeof s === 'string' && toNumber(s) === false;\n}\n"]}