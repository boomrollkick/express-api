{"version":3,"sources":["../../../src/node_modules/async-limiter/index.js"],"names":["Queue","options","concurrency","Infinity","pending","jobs","cbs","_done","done","bind","arrayAddMethods","forEach","method","prototype","methodResult","Array","apply","arguments","_run","Object","defineProperty","get","length","job","shift","cb","pop","process","nextTick","onDone","push","module","exports"],"mappings":"AAAA;;AAEA,SAASA,KAAT,CAAeC,OAAf,EAAwB;AACtB,MAAI,EAAE,gBAAgBD,KAAlB,CAAJ,EAA8B;AAC5B,WAAO,IAAIA,KAAJ,CAAUC,OAAV,CAAP;AACD;;AAEDA,YAAUA,WAAW,EAArB;AACA,OAAKC,WAAL,GAAmBD,QAAQC,WAAR,IAAuBC,QAA1C;AACA,OAAKC,OAAL,GAAe,CAAf;AACA,OAAKC,IAAL,GAAY,EAAZ;AACA,OAAKC,GAAL,GAAW,EAAX;AACA,OAAKC,KAAL,GAAaC,KAAKC,IAAL,CAAU,IAAV,CAAb;AACD;;AAED,IAAIC,kBAAkB,CACpB,MADoB,EAEpB,SAFoB,EAGpB,QAHoB,CAAtB;;AAMAA,gBAAgBC,OAAhB,CAAwB,UAASC,MAAT,EAAiB;AACvCZ,QAAMa,SAAN,CAAgBD,MAAhB,IAA0B,YAAW;AACnC,QAAIE,eAAeC,MAAMF,SAAN,CAAgBD,MAAhB,EAAwBI,KAAxB,CAA8B,KAAKX,IAAnC,EAAyCY,SAAzC,CAAnB;AACA,SAAKC,IAAL;AACA,WAAOJ,YAAP;AACD,GAJD;AAKD,CAND;;AAQAK,OAAOC,cAAP,CAAsBpB,MAAMa,SAA5B,EAAuC,QAAvC,EAAiD;AAC/CQ,OAAK,eAAW;AACd,WAAO,KAAKjB,OAAL,GAAe,KAAKC,IAAL,CAAUiB,MAAhC;AACD;AAH8C,CAAjD;;AAMAtB,MAAMa,SAAN,CAAgBK,IAAhB,GAAuB,YAAW;AAChC,MAAI,KAAKd,OAAL,KAAiB,KAAKF,WAA1B,EAAuC;AACrC;AACD;AACD,MAAI,KAAKG,IAAL,CAAUiB,MAAd,EAAsB;AACpB,QAAIC,MAAM,KAAKlB,IAAL,CAAUmB,KAAV,EAAV;AACA,SAAKpB,OAAL;AACAmB,QAAI,KAAKhB,KAAT;AACA,SAAKW,IAAL;AACD;;AAED,MAAI,KAAKd,OAAL,KAAiB,CAArB,EAAwB;AACtB,WAAO,KAAKE,GAAL,CAASgB,MAAT,KAAoB,CAA3B,EAA8B;AAC5B,UAAIG,KAAK,KAAKnB,GAAL,CAASoB,GAAT,EAAT;AACAC,cAAQC,QAAR,CAAiBH,EAAjB;AACD;AACF;AACF,CAjBD;;AAmBAzB,MAAMa,SAAN,CAAgBgB,MAAhB,GAAyB,UAASJ,EAAT,EAAa;AACpC,MAAI,OAAOA,EAAP,KAAc,UAAlB,EAA8B;AAC5B,SAAKnB,GAAL,CAASwB,IAAT,CAAcL,EAAd;AACA,SAAKP,IAAL;AACD;AACF,CALD;;AAOA,SAASV,IAAT,GAAgB;AACd,OAAKJ,OAAL;AACA,OAAKc,IAAL;AACD;;AAEDa,OAAOC,OAAP,GAAiBhC,KAAjB","file":"index.js","sourcesContent":["'use strict';\n\nfunction Queue(options) {\n  if (!(this instanceof Queue)) {\n    return new Queue(options);\n  }\n\n  options = options || {};\n  this.concurrency = options.concurrency || Infinity;\n  this.pending = 0;\n  this.jobs = [];\n  this.cbs = [];\n  this._done = done.bind(this);\n}\n\nvar arrayAddMethods = [\n  'push',\n  'unshift',\n  'splice'\n];\n\narrayAddMethods.forEach(function(method) {\n  Queue.prototype[method] = function() {\n    var methodResult = Array.prototype[method].apply(this.jobs, arguments);\n    this._run();\n    return methodResult;\n  };\n});\n\nObject.defineProperty(Queue.prototype, 'length', {\n  get: function() {\n    return this.pending + this.jobs.length;\n  }\n});\n\nQueue.prototype._run = function() {\n  if (this.pending === this.concurrency) {\n    return;\n  }\n  if (this.jobs.length) {\n    var job = this.jobs.shift();\n    this.pending++;\n    job(this._done);\n    this._run();\n  }\n\n  if (this.pending === 0) {\n    while (this.cbs.length !== 0) {\n      var cb = this.cbs.pop();\n      process.nextTick(cb);\n    }\n  }\n};\n\nQueue.prototype.onDone = function(cb) {\n  if (typeof cb === 'function') {\n    this.cbs.push(cb);\n    this._run();\n  }\n};\n\nfunction done() {\n  this.pending--;\n  this._run();\n}\n\nmodule.exports = Queue;\n"]}