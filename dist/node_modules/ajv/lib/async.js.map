{"version":3,"sources":["../../../../src/node_modules/ajv/lib/async.js"],"names":["module","exports","setup","setupAsync","compile","compileAsync","util","require","ASYNC","checkGenerators","checkAsyncFunction","TRANSPILE","getNodent","getRegenerator","MODES","async","transpile","regenerator","nodent","opts","required","check","get","Error","_transpileFunc","i","length","_opts","copy","Function","e","name","runtime","regeneratorTranspile","code","log","dontInstallRequireHook","console","warn","nodentTranspile","promises","sourcemap","schema","callback","schemaObj","self","_addSchema","setTimeout","validate","loadSchema","_compileAsync","firstCall","missingSchema","loadMissingSchema","deferCallback","ref","_refs","_schemas","missingRef","_callbacks","_loadingSchemas","schemaLoaded","err","sch","addSchema"],"mappings":"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","file":"async.js","sourcesContent":["'use strict';\n\nmodule.exports = {\n  setup: setupAsync,\n  compile: compileAsync\n};\n\n\nvar util = require('./compile/util');\n\nvar ASYNC = {\n  '*': checkGenerators,\n  'co*': checkGenerators,\n  'es7': checkAsyncFunction\n};\n\nvar TRANSPILE = {\n  'nodent': getNodent,\n  'regenerator': getRegenerator\n};\n\nvar MODES = [\n  { async: 'co*' },\n  { async: 'es7', transpile: 'nodent' },\n  { async: 'co*', transpile: 'regenerator' }\n];\n\n\nvar regenerator, nodent;\n\n\nfunction setupAsync(opts, required) {\n  if (required !== false) required = true;\n  var async = opts.async\n    , transpile = opts.transpile\n    , check;\n\n  switch (typeof transpile) {\n    case 'string':\n      var get = TRANSPILE[transpile];\n      if (!get) throw new Error('bad transpiler: ' + transpile);\n      return (opts._transpileFunc = get(opts, required));\n    case 'undefined':\n    case 'boolean':\n      if (typeof async == 'string') {\n        check = ASYNC[async];\n        if (!check) throw new Error('bad async mode: ' + async);\n        return (opts.transpile = check(opts, required));\n      }\n\n      for (var i=0; i<MODES.length; i++) {\n        var _opts = MODES[i];\n        if (setupAsync(_opts, false)) {\n          util.copy(_opts, opts);\n          return opts.transpile;\n        }\n      }\n      /* istanbul ignore next */\n      throw new Error('generators, nodent and regenerator are not available');\n    case 'function':\n      return (opts._transpileFunc = opts.transpile);\n    default:\n      throw new Error('bad transpiler: ' + transpile);\n  }\n}\n\n\nfunction checkGenerators(opts, required) {\n  /* jshint evil: true */\n  try {\n    (new Function('(function*(){})()'))();\n    return true;\n  } catch(e) {\n    /* istanbul ignore next */\n    if (required) throw new Error('generators not supported');\n  }\n}\n\n\nfunction checkAsyncFunction(opts, required) {\n  /* jshint evil: true */\n  try {\n    (new Function('(async function(){})()'))();\n    /* istanbul ignore next */\n    return true;\n  } catch(e) {\n    if (required) throw new Error('es7 async functions not supported');\n  }\n}\n\n\nfunction getRegenerator(opts, required) {\n  try {\n    if (!regenerator) {\n      var name = 'regenerator';\n      regenerator = require(name);\n      regenerator.runtime();\n    }\n    if (!opts.async || opts.async === true)\n      opts.async = 'es7';\n    return regeneratorTranspile;\n  } catch(e) {\n    /* istanbul ignore next */\n    if (required) throw new Error('regenerator not available');\n  }\n}\n\n\nfunction regeneratorTranspile(code) {\n  return regenerator.compile(code).code;\n}\n\n\nfunction getNodent(opts, required) {\n  /* jshint evil: true */\n  try {\n    if (!nodent) {\n      var name = 'nodent';\n      nodent = require(name)({ log: false, dontInstallRequireHook: true });\n    }\n    if (opts.async != 'es7') {\n      if (opts.async && opts.async !== true) console.warn('nodent transpiles only es7 async functions');\n      opts.async = 'es7';\n    }\n    return nodentTranspile;\n  } catch(e) {\n    /* istanbul ignore next */\n    if (required) throw new Error('nodent not available');\n  }\n}\n\n\nfunction nodentTranspile(code) {\n  return nodent.compile(code, '', { promises: true, sourcemap: false }).code;\n}\n\n\n/**\n * Creates validating function for passed schema with asynchronous loading of missing schemas.\n * `loadSchema` option should be a function that accepts schema uri and node-style callback.\n * @this  Ajv\n * @param {Object}   schema schema object\n * @param {Function} callback node-style callback, it is always called with 2 parameters: error (or null) and validating function.\n */\nfunction compileAsync(schema, callback) {\n  /* eslint no-shadow: 0 */\n  /* jshint validthis: true */\n  var schemaObj;\n  var self = this;\n  try {\n    schemaObj = this._addSchema(schema);\n  } catch(e) {\n    setTimeout(function() { callback(e); });\n    return;\n  }\n  if (schemaObj.validate) {\n    setTimeout(function() { callback(null, schemaObj.validate); });\n  } else {\n    if (typeof this._opts.loadSchema != 'function')\n      throw new Error('options.loadSchema should be a function');\n    _compileAsync(schema, callback, true);\n  }\n\n\n  function _compileAsync(schema, callback, firstCall) {\n    var validate;\n    try { validate = self.compile(schema); }\n    catch(e) {\n      if (e.missingSchema) loadMissingSchema(e);\n      else deferCallback(e);\n      return;\n    }\n    deferCallback(null, validate);\n\n    function loadMissingSchema(e) {\n      var ref = e.missingSchema;\n      if (self._refs[ref] || self._schemas[ref])\n        return callback(new Error('Schema ' + ref + ' is loaded but ' + e.missingRef + ' cannot be resolved'));\n      var _callbacks = self._loadingSchemas[ref];\n      if (_callbacks) {\n        if (typeof _callbacks == 'function')\n          self._loadingSchemas[ref] = [_callbacks, schemaLoaded];\n        else\n          _callbacks[_callbacks.length] = schemaLoaded;\n      } else {\n        self._loadingSchemas[ref] = schemaLoaded;\n        self._opts.loadSchema(ref, function (err, sch) {\n          var _callbacks = self._loadingSchemas[ref];\n          delete self._loadingSchemas[ref];\n          if (typeof _callbacks == 'function') {\n            _callbacks(err, sch);\n          } else {\n            for (var i=0; i<_callbacks.length; i++)\n              _callbacks[i](err, sch);\n          }\n        });\n      }\n\n      function schemaLoaded(err, sch) {\n        if (err) return callback(err);\n        if (!(self._refs[ref] || self._schemas[ref])) {\n          try {\n            self.addSchema(sch, ref);\n          } catch(e) {\n            callback(e);\n            return;\n          }\n        }\n        _compileAsync(schema, callback);\n      }\n    }\n\n    function deferCallback(err, validate) {\n      if (firstCall) setTimeout(function() { callback(err, validate); });\n      else return callback(err, validate);\n    }\n  }\n}\n"]}