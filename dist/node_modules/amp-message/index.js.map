{"version":3,"sources":["../../../src/node_modules/amp-message/index.js"],"names":["fmt","require","format","amp","methods","module","exports","Message","args","Buffer","isBuffer","decode","forEach","method","prototype","apply","arguments","inspect","length","toBuffer","encode","msg","i","unpack","tmp","Array","pack","arg","undefined","JSON","stringify","isJSON","parse","slice","isString","toString","isId"],"mappings":";;AACA;;;;AAIA,IAAIA,MAAMC,QAAQ,MAAR,EAAgBC,MAA1B;AACA,IAAIC,MAAMF,QAAQ,KAAR,CAAV;;AAEA;;;;AAIA,IAAIG,UAAU,CACZ,MADY,EAEZ,KAFY,EAGZ,OAHY,EAIZ,SAJY,CAAd;;AAOA;;;;AAIAC,OAAOC,OAAP,GAAiBC,OAAjB;;AAEA;;;;;;;;AAQA,SAASA,OAAT,CAAiBC,IAAjB,EAAuB;AACrB,MAAIC,OAAOC,QAAP,CAAgBF,IAAhB,CAAJ,EAA2BA,OAAOG,OAAOH,IAAP,CAAP;AAC3B,OAAKA,IAAL,GAAYA,QAAQ,EAApB;AACD;;AAED;;AAEAJ,QAAQQ,OAAR,CAAgB,UAASC,MAAT,EAAgB;AAC9BN,UAAQO,SAAR,CAAkBD,MAAlB,IAA4B,YAAU;AACpC,WAAO,KAAKL,IAAL,CAAUK,MAAV,EAAkBE,KAAlB,CAAwB,KAAKP,IAA7B,EAAmCQ,SAAnC,CAAP;AACD,GAFD;AAGD,CAJD;;AAMA;;;;;;;AAOAT,QAAQO,SAAR,CAAkBG,OAAlB,GAA4B,YAAU;AACpC,SAAOjB,IAAI,2BAAJ,EACL,KAAKQ,IAAL,CAAUU,MADL,EAEL,KAAKC,QAAL,GAAgBD,MAFX,CAAP;AAGD,CAJD;;AAMA;;;;;;;AAOAX,QAAQO,SAAR,CAAkBK,QAAlB,GAA6B,YAAU;AACrC,SAAOC,OAAO,KAAKZ,IAAZ,CAAP;AACD,CAFD;;AAIA;;;;;;;;AAQA,SAASG,MAAT,CAAgBU,GAAhB,EAAqB;AACnB,MAAIb,OAAOL,IAAIQ,MAAJ,CAAWU,GAAX,CAAX;;AAEA,OAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAId,KAAKU,MAAzB,EAAiCI,GAAjC,EAAsC;AACpCd,SAAKc,CAAL,IAAUC,OAAOf,KAAKc,CAAL,CAAP,CAAV;AACD;;AAED,SAAOd,IAAP;AACD;;AAED;;;;;;;;AAQA,SAASY,MAAT,CAAgBZ,IAAhB,EAAsB;AACpB,MAAIgB,MAAM,IAAIC,KAAJ,CAAUjB,KAAKU,MAAf,CAAV;;AAEA,OAAK,IAAII,IAAI,CAAb,EAAgBA,IAAId,KAAKU,MAAzB,EAAiCI,GAAjC,EAAsC;AACpCE,QAAIF,CAAJ,IAASI,KAAKlB,KAAKc,CAAL,CAAL,CAAT;AACD;;AAED,SAAOnB,IAAIiB,MAAJ,CAAWI,GAAX,CAAP;AACD;;AAED;;;;;;;;AAQA,SAASE,IAAT,CAAcC,GAAd,EAAmB;AACjB;AACA,MAAIlB,OAAOC,QAAP,CAAgBiB,GAAhB,CAAJ,EAA0B,OAAOA,GAAP;;AAE1B;AACA,MAAI,YAAY,OAAOA,GAAvB,EAA4B,OAAO,IAAIlB,MAAJ,CAAW,OAAOkB,GAAlB,CAAP;;AAE5B;AACA,MAAIA,QAAQC,SAAZ,EAAuBD,MAAM,IAAN;;AAEvB;AACA,SAAO,IAAIlB,MAAJ,CAAW,OAAOoB,KAAKC,SAAL,CAAeH,GAAf,CAAlB,CAAP;AACD;;AAED;;;;;;;;AAQA,SAASJ,MAAT,CAAgBI,GAAhB,EAAqB;AACnB;AACA,MAAII,OAAOJ,GAAP,CAAJ,EAAiB,OAAOE,KAAKG,KAAL,CAAWL,IAAIM,KAAJ,CAAU,CAAV,CAAX,CAAP;;AAEjB;AACA,MAAIC,SAASP,GAAT,CAAJ,EAAmB,OAAOA,IAAIM,KAAJ,CAAU,CAAV,EAAaE,QAAb,EAAP;;AAEnB;AACA,SAAOR,GAAP;AACD;;AAED;;;;AAIA,SAASO,QAAT,CAAkBP,GAAlB,EAAuB;AACrB,SAAO,OAAOA,IAAI,CAAJ,CAAP,IAAiB,MAAMA,IAAI,CAAJ,CAA9B;AACD;;AAED;;;;AAIA,SAASI,MAAT,CAAgBJ,GAAhB,EAAqB;AACnB,SAAO,OAAOA,IAAI,CAAJ,CAAP,IAAiB,MAAMA,IAAI,CAAJ,CAA9B;AACD;;AAED;;;;AAIA,SAASS,IAAT,CAAcT,GAAd,EAAmB;AACjB,SAAO,OAAOA,IAAI,CAAJ,CAAP,IAAiB,MAAMA,IAAI,CAAJ,CAA9B;AACD","file":"index.js","sourcesContent":["\n/**\n * Module dependencies.\n */\n\nvar fmt = require('util').format;\nvar amp = require('amp');\n\n/**\n * Proxy methods.\n */\n\nvar methods = [\n  'push',\n  'pop',\n  'shift',\n  'unshift'\n];\n\n/**\n * Expose `Message`.\n */\n\nmodule.exports = Message;\n\n/**\n * Initialize an AMP message with the\n * given `args` or message buffer.\n *\n * @param {Array|Buffer} args or blob\n * @api public\n */\n\nfunction Message(args) {\n  if (Buffer.isBuffer(args)) args = decode(args);\n  this.args = args || [];\n}\n\n// proxy methods\n\nmethods.forEach(function(method){\n  Message.prototype[method] = function(){\n    return this.args[method].apply(this.args, arguments);\n  };\n});\n\n/**\n * Inspect the message.\n *\n * @return {String}\n * @api public\n */\n\nMessage.prototype.inspect = function(){\n  return fmt('<Message args=%d size=%d>',\n    this.args.length,\n    this.toBuffer().length);\n};\n\n/**\n * Return an encoded AMP message.\n *\n * @return {Buffer}\n * @api public\n */\n\nMessage.prototype.toBuffer = function(){\n  return encode(this.args);\n};\n\n/**\n * Decode `msg` and unpack all args.\n *\n * @param {Buffer} msg\n * @return {Array}\n * @api private\n */\n\nfunction decode(msg) {\n  var args = amp.decode(msg);\n  \n  for (var i = 0; i < args.length; i++) {\n    args[i] = unpack(args[i]);\n  }\n\n  return args;\n}\n\n/**\n * Encode and pack all `args`.\n *\n * @param {Array} args\n * @return {Buffer}\n * @api private\n */\n\nfunction encode(args) {\n  var tmp = new Array(args.length);\n\n  for (var i = 0; i < args.length; i++) {\n    tmp[i] = pack(args[i]);\n  }\n\n  return amp.encode(tmp);\n}\n\n/**\n * Pack `arg`.\n *\n * @param {Mixed} arg\n * @return {Buffer}\n * @api private\n */\n\nfunction pack(arg) {\n  // blob\n  if (Buffer.isBuffer(arg)) return arg;\n\n  // string\n  if ('string' == typeof arg) return new Buffer('s:' + arg);\n\n  // undefined\n  if (arg === undefined) arg = null;\n\n  // json\n  return new Buffer('j:' + JSON.stringify(arg));\n}\n\n/**\n * Unpack `arg`.\n *\n * @param {Buffer} arg\n * @return {Mixed}\n * @api private\n */\n\nfunction unpack(arg) {\n  // json\n  if (isJSON(arg)) return JSON.parse(arg.slice(2));\n\n  // string\n  if (isString(arg)) return arg.slice(2).toString();\n \n  // blob\n  return arg;\n}\n\n/**\n * String argument.\n */\n\nfunction isString(arg) {\n  return 115 == arg[0] && 58 == arg[1];\n}\n\n/**\n * JSON argument.\n */\n\nfunction isJSON(arg) {\n  return 106 == arg[0] && 58 == arg[1];\n}\n\n/**\n * ID argument.\n */\n\nfunction isId(arg) {\n  return 105 == arg[0] && 58 == arg[1];\n}\n"]}