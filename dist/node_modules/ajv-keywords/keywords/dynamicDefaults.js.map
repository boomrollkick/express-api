{"version":3,"sources":["../../../../src/node_modules/ajv-keywords/keywords/dynamicDefaults.js"],"names":["sequences","DEFAULTS","timestamp","Date","now","datetime","toISOString","date","slice","time","random","Math","randomint","args","limit","max","floor","seq","name","module","exports","defFunc","ajv","definition","compile","schema","parentSchema","it","funcs","key","d","func","getDefault","length","opts","useDefaults","compositeRule","assignDefaults","noop","data","prop","undefined","metaSchema","type","additionalProperties","required","properties","addKeyword","def","Error"],"mappings":"AAAA;;AAEA,IAAIA,YAAY,EAAhB;;AAEA,IAAIC,WAAW;AACbC,aAAW,qBAAW;AAAE,WAAOC,KAAKC,GAAL,EAAP;AAAoB,GAD/B;AAEbC,YAAU,oBAAW;AAAE,WAAQ,IAAIF,IAAJ,EAAD,CAAWG,WAAX,EAAP;AAAkC,GAF5C;AAGbC,QAAM,gBAAW;AAAE,WAAQ,IAAIJ,IAAJ,EAAD,CAAWG,WAAX,GAAyBE,KAAzB,CAA+B,CAA/B,EAAkC,EAAlC,CAAP;AAA+C,GAHrD;AAIbC,QAAM,gBAAW;AAAE,WAAQ,IAAIN,IAAJ,EAAD,CAAWG,WAAX,GAAyBE,KAAzB,CAA+B,EAA/B,CAAP;AAA4C,GAJlD;AAKbE,UAAQ,kBAAW;AAAE,WAAOC,KAAKD,MAAL,EAAP;AAAuB,GAL/B;AAMbE,aAAW,mBAAUC,IAAV,EAAgB;AACzB,QAAIC,QAAQD,QAAQA,KAAKE,GAAb,IAAoB,CAAhC;AACA,WAAO,YAAW;AAAE,aAAOJ,KAAKK,KAAL,CAAWL,KAAKD,MAAL,KAAgBI,KAA3B,CAAP;AAA2C,KAA/D;AACD,GATY;AAUbG,OAAK,aAAUJ,IAAV,EAAgB;AACnB,QAAIK,OAAOL,QAAQA,KAAKK,IAAb,IAAqB,EAAhC;AACAlB,cAAUkB,IAAV,IAAkBlB,UAAUkB,IAAV,KAAmB,CAArC;AACA,WAAO,YAAW;AAAE,aAAOlB,UAAUkB,IAAV,GAAP;AAA2B,KAA/C;AACD;AAdY,CAAf;;AAiBAC,OAAOC,OAAP,GAAiB,SAASC,OAAT,CAAiBC,GAAjB,EAAsB;AACrCD,UAAQE,UAAR,GAAqB;AACnBC,aAAS,iBAAUC,MAAV,EAAkBC,YAAlB,EAAgCC,EAAhC,EAAoC;AAC3C,UAAIC,QAAQ,EAAZ;;AAEA,WAAK,IAAIC,GAAT,IAAgBJ,MAAhB,EAAwB;AACtB,YAAIK,IAAIL,OAAOI,GAAP,CAAR;AACA,YAAIE,OAAOC,WAAW,OAAOF,CAAP,IAAY,QAAZ,GAAuBA,CAAvB,GAA2BA,EAAEC,IAAxC,CAAX;AACAH,cAAMC,GAAN,IAAaE,KAAKE,MAAL,GAAcF,KAAKD,EAAEjB,IAAP,CAAd,GAA6BkB,IAA1C;AACD;;AAED,aAAOJ,GAAGO,IAAH,CAAQC,WAAR,IAAuB,CAACR,GAAGS,aAA3B,GACGC,cADH,GAEGC,IAFV;;AAIA,eAASD,cAAT,CAAwBE,IAAxB,EAA8B;AAC5B,aAAK,IAAIC,IAAT,IAAiBf,MAAjB;AACE,cAAIc,KAAKC,IAAL,MAAeC,SAAnB,EAA8BF,KAAKC,IAAL,IAAaZ,MAAMY,IAAN,GAAb;AADhC,SAEA,OAAO,IAAP;AACD;;AAED,eAASF,IAAT,GAAgB;AAAE,eAAO,IAAP;AAAc;AACjC,KArBkB;AAsBnBrC,cAAUA,QAtBS;AAuBnByC,gBAAY;AACVC,YAAM,QADI;AAEVC,4BAAsB;AACpBD,cAAM,CAAC,QAAD,EAAW,QAAX,CADc;AAEpBC,8BAAsB,KAFF;AAGpBC,kBAAU,CAAC,MAAD,EAAS,MAAT,CAHU;AAIpBC,oBAAY;AACVf,gBAAM,EAAEY,MAAM,QAAR,EADI;AAEV9B,gBAAM,EAAE8B,MAAM,QAAR;AAFI;AAJQ;AAFZ;AAvBO,GAArB;;AAqCArB,MAAIyB,UAAJ,CAAe,iBAAf,EAAkC1B,QAAQE,UAA1C;AACA,SAAOD,GAAP;;AAEA,WAASU,UAAT,CAAoBF,CAApB,EAAuB;AACrB,QAAIkB,MAAM/C,SAAS6B,CAAT,CAAV;AACA,QAAIkB,GAAJ,EAAS,OAAOA,GAAP;AACT,UAAM,IAAIC,KAAJ,CAAU,uDAAuDnB,CAAjE,CAAN;AACD;AACF,CA9CD","file":"dynamicDefaults.js","sourcesContent":["'use strict';\n\nvar sequences = {};\n\nvar DEFAULTS = {\n  timestamp: function() { return Date.now(); },\n  datetime: function() { return (new Date).toISOString(); },\n  date: function() { return (new Date).toISOString().slice(0, 10); },\n  time: function() { return (new Date).toISOString().slice(11); },\n  random: function() { return Math.random(); },\n  randomint: function (args) {\n    var limit = args && args.max || 2;\n    return function() { return Math.floor(Math.random() * limit); };\n  },\n  seq: function (args) {\n    var name = args && args.name || '';\n    sequences[name] = sequences[name] || 0;\n    return function() { return sequences[name]++; };\n  }\n};\n\nmodule.exports = function defFunc(ajv) {\n  defFunc.definition = {\n    compile: function (schema, parentSchema, it) {\n      var funcs = {};\n\n      for (var key in schema) {\n        var d = schema[key];\n        var func = getDefault(typeof d == 'string' ? d : d.func);\n        funcs[key] = func.length ? func(d.args) : func;\n      }\n\n      return it.opts.useDefaults && !it.compositeRule\n              ? assignDefaults\n              : noop;\n\n      function assignDefaults(data) {\n        for (var prop in schema)\n          if (data[prop] === undefined) data[prop] = funcs[prop]();\n        return true;\n      }\n\n      function noop() { return true; }\n    },\n    DEFAULTS: DEFAULTS,\n    metaSchema: {\n      type: 'object',\n      additionalProperties: {\n        type: ['string', 'object'],\n        additionalProperties: false,\n        required: ['func', 'args'],\n        properties: {\n          func: { type: 'string' },\n          args: { type: 'object' }\n        }\n      }\n    }\n  };\n\n  ajv.addKeyword('dynamicDefaults', defFunc.definition);\n  return ajv;\n\n  function getDefault(d) {\n    var def = DEFAULTS[d];\n    if (def) return def;\n    throw new Error('invalid \"dynamicDefaults\" keyword property value: ' + d);\n  }\n};\n"]}